<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Mix Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6e8efb;
            --secondary: #a777e3;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #dddddd;
            --success: #4caf50;
            --error: #e74c3c;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        .dark-theme {
            --primary: #8ba4ff;
            --secondary: #c19aff;
            --background: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #f0f0f0;
            --text-light: #bbbbbb;
            --border: #444444;
            --success: #6ec071;
            --error: #ff6b6b;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: var(--transition);
        }

        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            position: relative;
        }

        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }

        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .description {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .emoji-selector-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            width: 100%;
        }

        .emoji-selector {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
        }

        .selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .selector-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .selector-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text);
        }

        .control-btn:hover {
            background-color: var(--primary);
            color: white;
        }

        .emoji-search {
            position: relative;
            margin-bottom: 15px;
        }

        .emoji-search input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            background-color: var(--card-bg);
            color: var(--text);
        }

        .emoji-search i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .emoji-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .category-btn {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 15px;
            background-color: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .category-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .emoji-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px 5px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
        }

        .emoji-item {
            font-size: 1.8rem;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            position: relative;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-item:hover {
            background-color: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .emoji-item.selected {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 0 0 2px var(--secondary);
        }

        .emoji-item.unsupported {
            opacity: 0.5;
            filter: grayscale(1);
            cursor: not-allowed;
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-style: italic;
        }

        .selected-emojis {
            margin-top: 15px;
            text-align: center;
            font-size: 1.2rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .browse-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
        }

        .browse-btn:hover {
            background-color: var(--secondary);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }

        .btn-secondary {
            background-color: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-container {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .emoji-preview {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .result-image-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            max-width: 300px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-canvas {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            display: none;
        }

        .loading {
            display: none;
            margin: 20px 0;
        }

        .loading-spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            color: var(--error);
            margin: 15px 0;
            display: none;
        }

        .success {
            color: var(--success);
            margin: 15px 0;
            display: none;
        }

        .action-buttons-result {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .settings-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .settings-btn:hover {
            transform: scale(1.1);
        }

        .settings-panel {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            width: 300px;
            z-index: 1000;
            display: none;
        }

        .settings-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .setting-group {
            margin-bottom: 10px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }

        .setting-group select, .setting-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--text);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--border);
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-light);
            font-size: 0.9rem;
            width: 100%;
        }

        .hidden {
            display: none;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .emoji-selector-container {
                flex-direction: column;
                align-items: center;
            }
            
            .emoji-selector {
                max-width: 100%;
            }
            
            .emoji-list {
                grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons-result {
                flex-direction: column;
            }
            
            .settings-panel {
                width: 80%;
                right: 10%;
                left: 10%;
            }
        }

        /* Vibration animation */
        @keyframes vibrate {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .vibrate {
            animation: vibrate 0.3s linear;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo" id="logo">ü•¥</div>
            <h1>Emoji Mix Generator</h1>
            <p class="description">Gabungkan dua emoji menjadi satu gambar campuran yang unik!</p>
        </header>

        <div class="emoji-selector-container">
            <div class="emoji-selector">
                <div class="selector-header">
                    <div class="selector-title">Emoji 1</div>
                    <div class="selector-controls">
                        <button class="control-btn" id="shuffleEmoji1">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="clearEmoji1">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emoji-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchEmoji1" placeholder="Cari emoji atau kode...">
                </div>

                <div class="emoji-categories" id="categories1">
                    <!-- Kategori akan diisi oleh JavaScript -->
                </div>

                <div class="emoji-list" id="emojiList1">
                    <!-- Emoji akan diisi oleh JavaScript -->
                </div>

                <div class="selected-emojis">
                    <span id="selectedEmoji1">Pilih emoji pertama</span>
                    <button class="browse-btn" id="browseEmoji1" title="Lihat hasil mix" style="display: none;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="emoji-selector">
                <div class="selector-header">
                    <div class="selector-title">Emoji 2</div>
                    <div class="selector-controls">
                        <button class="control-btn" id="shuffleEmoji2">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="clearEmoji2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                
                <div class="emoji-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchEmoji2" placeholder="Cari emoji atau kode...">
                </div>

                <div class="emoji-categories" id="categories2">
                    <!-- Kategori akan diisi oleh JavaScript -->
                </div>

                <div class="emoji-list" id="emojiList2">
                    <!-- Emoji akan diisi oleh JavaScript -->
                </div>

                <div class="selected-emojis">
                    <span id="selectedEmoji2">Pilih emoji kedua</span>
                    <button class="browse-btn" id="browseEmoji2" title="Lihat hasil mix" style="display: none;">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" id="generateBtn">
                <i class="fas fa-cog"></i> Generate Mix
            </button>
        </div>

        <div class="result-container">
            <div class="emoji-preview" id="emojiPreview"></div>
            
            <div class="result-image-container">
                <canvas class="result-canvas" id="resultCanvas" width="300" height="300"></canvas>
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>Sedang memproses...</p>
                </div>
            </div>
            
            <div class="error" id="error"></div>
            <div class="success" id="success"></div>

            <div class="action-buttons-result">
                <button class="btn btn-secondary" id="downloadBtn" disabled>
                    <i class="fas fa-download"></i> Unduh
                </button>
                <button class="btn btn-primary" id="copyBtn" disabled>
                    <i class="fas fa-copy"></i> Salin Gambar
                </button>
            </div>
        </div>

        <button class="settings-btn" id="settingsBtn">
            <i class="fas fa-cog"></i>
        </button>

        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3><i class="fas fa-cog"></i> Pengaturan</h3>
                <button class="control-btn" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="settings-content">
                <div class="setting-group">
                    <div class="toggle-label">
                        <label for="themeToggle">Tema Gelap</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="themeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="toggle-label">
                        <label for="soundToggle">Efek Suara</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="toggle-label">
                        <label for="vibrationToggle">Getaran</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="toggle-label">
                        <label for="animationToggle">Emoji Animasi</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="animationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <label for="primaryColorPicker">Warna Primer</label>
                    <div class="color-picker">
                        <div class="color-preview" id="primaryColorPreview" style="background-color: #6e8efb"></div>
                        <input type="color" id="primaryColorPicker" value="#6e8efb">
                    </div>
                </div>

                <div class="setting-group">
                    <label for="secondaryColorPicker">Warna Sekunder</label>
                    <div class="color-picker">
                        <div class="color-preview" id="secondaryColorPreview" style="background-color: #a777e3"></div>
                        <input type="color" id="secondaryColorPicker" value="#a777e3">
                    </div>
                </div>

                <div class="setting-group">
                    <label for="backgroundColorPicker">Warna Latar</label>
                    <div class="color-picker">
                        <div class="color-preview" id="backgroundColorPreview" style="background-color: #f8f9fa"></div>
                        <input type="color" id="backgroundColorPicker" value="#f8f9fa">
                    </div>
                </div>

                <div class="setting-group">
                    <label for="fontSelect">Jenis Font</label>
                    <select id="fontSelect">
                        <option value="Segoe UI, Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value='Courier New, Courier, monospace'>Courier New</option>
                        <option value="Verdana, Geneva, sans-serif">Verdana</option>
                    </select>
                </div>
            </div>
        </div>

        <footer>
            <p>Dibuat dengan ‚ù§Ô∏è menggunakan HTML, CSS, dan JavaScript | API oleh Google Tenor</p>
        </footer>
    </div>

    <!-- Sound effects -->
    <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" preload="auto"></audio>
    <audio id="successSound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" preload="auto"></audio>
    <audio id="errorSound" src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-2851.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Elemen DOM
            const logo = document.getElementById('logo');
            const emojiList1 = document.getElementById('emojiList1');
            const emojiList2 = document.getElementById('emojiList2');
            const categories1 = document.getElementById('categories1');
            const categories2 = document.getElementById('categories2');
            const searchEmoji1 = document.getElementById('searchEmoji1');
            const searchEmoji2 = document.getElementById('searchEmoji2');
            const shuffleEmoji1 = document.getElementById('shuffleEmoji1');
            const shuffleEmoji2 = document.getElementById('shuffleEmoji2');
            const clearEmoji1 = document.getElementById('clearEmoji1');
            const clearEmoji2 = document.getElementById('clearEmoji2');
            const selectedEmoji1 = document.getElementById('selectedEmoji1');
            const selectedEmoji2 = document.getElementById('selectedEmoji2');
            const browseEmoji1 = document.getElementById('browseEmoji1');
            const browseEmoji2 = document.getElementById('browseEmoji2');
            const generateBtn = document.getElementById('generateBtn');
            const emojiPreview = document.getElementById('emojiPreview');
            const resultCanvas = document.getElementById('resultCanvas');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const success = document.getElementById('success');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsPanel = document.getElementById('settingsPanel');
            const closeSettings = document.getElementById('closeSettings');
            const themeToggle = document.getElementById('themeToggle');
            const soundToggle = document.getElementById('soundToggle');
            const vibrationToggle = document.getElementById('vibrationToggle');
            const animationToggle = document.getElementById('animationToggle');
            const primaryColorPicker = document.getElementById('primaryColorPicker');
            const secondaryColorPicker = document.getElementById('secondaryColorPicker');
            const backgroundColorPicker = document.getElementById('backgroundColorPicker');
            const primaryColorPreview = document.getElementById('primaryColorPreview');
            const secondaryColorPreview = document.getElementById('secondaryColorPreview');
            const backgroundColorPreview = document.getElementById('backgroundColorPreview');
            const fontSelect = document.getElementById('fontSelect');
            
            // Sound elements
            const clickSound = document.getElementById('clickSound');
            const successSound = document.getElementById('successSound');
            const errorSound = document.getElementById('errorSound');

            // Variabel state
            let selectedEmoji1Value = '';
            let selectedEmoji2Value = '';
            let emojiData = null;
            let allEmojis = [];
            let currentCategory1 = 'all';
            let currentCategory2 = 'all';
            let currentImageData = null;
            let supportedEmojis = [];

            // Ikon untuk setiap kategori
            const categoryIcons = {
                'all': 'fas fa-border-all',
                'smileys_emotion': 'fas fa-smile',
                'people_body': 'fas fa-user',
                'animals_nature': 'fas fa-leaf',
                'food_drink': 'fas fa-utensils',
                'travel_places': 'fas fa-plane',
                'activities': 'fas fa-basketball-ball',
                'objects': 'fas fa-lightbulb',
                'symbols': 'fas fa-heart',
                'flags': 'fas fa-flag'
            };

            // Set random logo
            function setRandomLogo() {
                const emojis = ['ü•¥', 'üòç', 'üòÇ', 'ü•∞', 'üòé', 'ü§©', 'üòú', 'ü§™', 'ü§ë', 'ü§Ø'];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                logo.textContent = randomEmoji;
            }

            // Load emoji data dari Emoji Mart
            async function loadEmojiData() {
                try {
                    const response = await fetch('https://cdn.jsdelivr.net/npm/@emoji-mart/data');
                    emojiData = await response.json();
                    
                    // Proses data emoji
                    processEmojiData();
                    
                    // Render kategori
                    renderCategories(categories1, 1);
                    renderCategories(categories2, 2);
                    
                    // Render emoji
                    renderEmojiGrid(emojiList1, allEmojis, 1);
                    renderEmojiGrid(emojiList2, allEmojis, 2);
                } catch (error) {
                    console.error('Gagal memuat data emoji:', error);
                    showError('Gagal memuat data emoji. Silakan refresh halaman.');
                }
            }

            // Proses data emoji
            function processEmojiData() {
                if (!emojiData || !emojiData.categories || !emojiData.emojis) return;
                
                // Ekstrak semua emoji
                allEmojis = [];
                for (const key in emojiData.emojis) {
                    if (emojiData.emojis.hasOwnProperty(key)) {
                        const emoji = emojiData.emojis[key];
                        allEmojis.push({
                            id: emoji.id,
                            name: emoji.name,
                            native: emoji.skins[0].native,
                            unified: emoji.unified,
                            keywords: emoji.keywords || [],
                            category: getCategoryName(emoji.category),
                            shortcodes: emoji.shortcodes || []
                        });
                    }
                }
                
                // Daftar emoji yang didukung (contoh)
                supportedEmojis = allEmojis.filter(emoji => 
                    !['flags', 'symbols'].includes(emoji.category)
                ).map(emoji => emoji.native);
            }

            // Dapatkan nama kategori berdasarkan ID
            function getCategoryName(categoryId) {
                if (!emojiData.categories) return 'other';
                
                const category = emojiData.categories.find(cat => cat.id === categoryId);
                return category ? category.id : 'other';
            }

            // Render kategori
            function renderCategories(container, gridNumber) {
                if (!emojiData.categories) return;
                
                // Tambahkan kategori "All"
                const allBtn = document.createElement('button');
                allBtn.className = 'category-btn active';
                allBtn.innerHTML = `<i class="${categoryIcons['all']}"></i> All`;
                allBtn.addEventListener('click', () => filterByCategory('all', gridNumber));
                container.appendChild(allBtn);
                
                // Tambahkan kategori lainnya
                emojiData.categories.forEach(category => {
                    const categoryBtn = document.createElement('button');
                    categoryBtn.className = 'category-btn';
                    categoryBtn.innerHTML = `<i class="${categoryIcons[category.id] || 'fas fa-question'}"></i> ${category.name}`;
                    categoryBtn.addEventListener('click', () => filterByCategory(category.id, gridNumber));
                    container.appendChild(categoryBtn);
                });
            }

            // Filter emoji berdasarkan kategori
            function filterByCategory(categoryId, gridNumber) {
                // Update active button
                const container = gridNumber === 1 ? categories1 : categories2;
                const buttons = container.querySelectorAll('.category-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                
                const activeBtn = Array.from(buttons).find(btn => 
                    (categoryId === 'all' && btn.querySelector('i').className === categoryIcons['all']) || 
                    btn.textContent.includes(emojiData.categories.find(c => c.id === categoryId)?.name)
                );
                
                if (activeBtn) activeBtn.classList.add('active');
                
                // Filter emoji
                let filteredEmojis = [];
                if (categoryId === 'all') {
                    filteredEmojis = allEmojis;
                } else {
                    const categoryName = getCategoryName(categoryId);
                    filteredEmojis = allEmojis.filter(emoji => emoji.category === categoryName);
                }
                
                // Simpan kategori aktif
                if (gridNumber === 1) {
                    currentCategory1 = categoryId;
                } else {
                    currentCategory2 = categoryId;
                }
                
                // Render emoji
                renderEmojiGrid(gridNumber === 1 ? emojiList1 : emojiList2, filteredEmojis, gridNumber);
            }

            // Render emoji grid
            function renderEmojiGrid(container, emojis, gridNumber) {
                container.innerHTML = '';
                
                if (emojis.length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.textContent = 'Tidak ada hasil yang ditemukan';
                    container.appendChild(noResults);
                    return;
                }
                
                emojis.forEach(emoji => {
                    const isSupported = supportedEmojis.includes(emoji.native);
                    
                    const emojiItem = document.createElement('div');
                    emojiItem.className = `emoji-item ${isSupported ? '' : 'unsupported'}`;
                    if (!isSupported) {
                        emojiItem.title = 'Emoji ini tidak didukung untuk di-mix';
                    } else {
                        emojiItem.title = emoji.name;
                    }
                    emojiItem.textContent = emoji.native;
                    
                    if (isSupported) {
                        emojiItem.addEventListener('click', () => selectEmoji(emoji.native, gridNumber));
                    }
                    
                    // Highlight jika sudah dipilih
                    if ((gridNumber === 1 && emoji.native === selectedEmoji1Value) || 
                        (gridNumber === 2 && emoji.native === selectedEmoji2Value)) {
                        emojiItem.classList.add('selected');
                    }
                    
                    container.appendChild(emojiItem);
                });
            }

            // Pilih emoji
            function selectEmoji(emoji, gridNumber) {
                playSound(clickSound);
                
                if (gridNumber === 1) {
                    // Pastikan emoji tidak sama dengan emoji kedua
                    if (emoji === selectedEmoji2Value) {
                        showError('Emoji pertama dan kedua tidak boleh sama');
                        if (vibrationToggle.checked) {
                            document.querySelector('.emoji-selector-container').classList.add('vibrate');
                            setTimeout(() => {
                                document.querySelector('.emoji-selector-container').classList.remove('vibrate');
                            }, 300);
                        }
                        return;
                    }
                    
                    selectedEmoji1Value = emoji;
                    selectedEmoji1.innerHTML = `<span class="${animationToggle.checked ? 'animated-emoji' : ''}">${emoji}</span>`;
                    browseEmoji1.style.display = 'inline-flex';
                    
                    // Update highlight
                    const emojiItems = emojiList1.querySelectorAll('.emoji-item');
                    emojiItems.forEach(item => {
                        item.classList.remove('selected');
                        if (item.textContent === emoji) {
                            item.classList.add('selected');
                        }
                    });
                } else {
                    // Pastikan emoji tidak sama dengan emoji pertama
                    if (emoji === selectedEmoji1Value) {
                        showError('Emoji pertama dan kedua tidak boleh sama');
                        if (vibrationToggle.checked) {
                            document.querySelector('.emoji-selector-container').classList.add('vibrate');
                            setTimeout(() => {
                                document.querySelector('.emoji-selector-container').classList.remove('vibrate');
                            }, 300);
                        }
                        return;
                    }
                    
                    selectedEmoji2Value = emoji;
                    selectedEmoji2.innerHTML = `<span class="${animationToggle.checked ? 'animated-emoji' : ''}">${emoji}</span>`;
                    browseEmoji2.style.display = 'inline-flex';
                    
                    // Update highlight
                    const emojiItems = emojiList2.querySelectorAll('.emoji-item');
                    emojiItems.forEach(item => {
                        item.classList.remove('selected');
                        if (item.textContent === emoji) {
                            item.classList.add('selected');
                        }
                    });
                }
                
                updatePreview();
                hideError();
            }

            // Acak emoji
            function shuffleEmoji(gridNumber) {
                playSound(clickSound);
                
                let availableEmojis = allEmojis.filter(emoji => {
                    const isSupported = supportedEmojis.includes(emoji.native);
                    if (!isSupported) return false;
                    
                    if (gridNumber === 1) {
                        return emoji.native !== selectedEmoji2Value;
                    } else {
                        return emoji.native !== selectedEmoji1Value;
                    }
                });
                
                if (availableEmojis.length === 0) {
                    showError('Tidak ada emoji lain yang tersedia');
                    return;
                }
                
                const randomIndex = Math.floor(Math.random() * availableEmojis.length);
                selectEmoji(availableEmojis[randomIndex].native, gridNumber);
            }

            // Hapus emoji
            function clearEmoji(gridNumber) {
                playSound(clickSound);
                
                if (gridNumber === 1) {
                    selectedEmoji1Value = '';
                    selectedEmoji1.textContent = 'Pilih emoji pertama';
                    browseEmoji1.style.display = 'none';
                    
                    // Hapus highlight
                    const emojiItems = emojiList1.querySelectorAll('.emoji-item');
                    emojiItems.forEach(item => {
                        item.classList.remove('selected');
                    });
                } else {
                    selectedEmoji2Value = '';
                    selectedEmoji2.textContent = 'Pilih emoji kedua';
                    browseEmoji2.style.display = 'none';
                    
                    // Hapus highlight
                    const emojiItems = emojiList2.querySelectorAll('.emoji-item');
                    emojiItems.forEach(item => {
                        item.classList.remove('selected');
                    });
                }
                
                updatePreview();
            }

            // Update preview
            function updatePreview() {
                if (selectedEmoji1Value && selectedEmoji2Value) {
                    emojiPreview.textContent = `${selectedEmoji1Value} + ${selectedEmoji2Value}`;
                } else {
                    emojiPreview.textContent = '';
                }
            }

            // Cari emoji
            function setupSearch(inputElement, gridNumber) {
                inputElement.addEventListener('input', () => {
                    const searchTerm = inputElement.value.toLowerCase();
                    
                    let filteredEmojis = [];
                    if (searchTerm === '') {
                        // Jika pencarian kosong, tampilkan berdasarkan kategori
                        const categoryId = gridNumber === 1 ? currentCategory1 : currentCategory2;
                        if (categoryId === 'all') {
                            filteredEmojis = allEmojis;
                        } else {
                            const categoryName = getCategoryName(categoryId);
                            filteredEmojis = allEmojis.filter(emoji => emoji.category === categoryName);
                        }
                    } else {
                        // Filter berdasarkan kata kunci, nama, atau kode unified
                        filteredEmojis = allEmojis.filter(emoji => {
                            return emoji.name.toLowerCase().includes(searchTerm) || 
                                   emoji.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm)) ||
                                   emoji.unified.toLowerCase().includes(searchTerm);
                        });
                    }
                    
                    renderEmojiGrid(gridNumber === 1 ? emojiList1 : emojiList2, filteredEmojis, gridNumber);
                });
            }

            // Generate emoji mix
            async function generateEmojiMix() {
                if (!selectedEmoji1Value || !selectedEmoji2Value) {
                    showError('Pilih dua emoji untuk digabungkan');
                    return;
                }
                
                try {
                    showLoading();
                    hideError();
                    hideSuccess();
                    
                    // Encode emoji menggunakan native representation
                    const encodedEmoji1 = encodeURIComponent(selectedEmoji1Value);
                    const encodedEmoji2 = encodeURIComponent(selectedEmoji2Value);
                    
                    // Panggil API Google Tenor
                    const response = await fetch(`https://tenor.googleapis.com/v2/featured?key=AIzaSyAyimkuYQYF_FXVALexPuGQctUWRURdCYQ&contentfilter=high&media_filter=png_transparent&component=proactive&collection=emoji_kitchen_v5&q=${encodedEmoji1}_${encodedEmoji2}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.results && data.results.length > 0) {
                        const imageUrl = data.results[0].url;
                        
                        // Load gambar ke canvas
                        const ctx = resultCanvas.getContext('2d');
                        const img = new Image();
                        img.crossOrigin = "Anonymous";
                        
                        img.onload = function() {
                            // Clear canvas
                            ctx.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
                            
                            // Draw image to canvas
                            ctx.drawImage(img, 0, 0, resultCanvas.width, resultCanvas.height);
                            
                            // Simpan data gambar
                            currentImageData = resultCanvas.toDataURL('image/png');
                            
                            // Tampilkan canvas
                            resultCanvas.style.display = 'block';
                            
                            // Aktifkan tombol unduh dan salin
                            downloadBtn.disabled = false;
                            copyBtn.disabled = false;
                            
                            hideLoading();
                            playSound(successSound);
                            showSuccess('Emoji mix berhasil dibuat!');
                        };
                        
                        img.onerror = function() {
                            throw new Error('Gagal memuat gambar');
                        };
                        
                        img.src = imageUrl;
                    } else {
                        throw new Error('Tidak ada hasil yang ditemukan untuk kombinasi emoji ini');
                    }
                } catch (err) {
                    hideLoading();
                    playSound(errorSound);
                    showError('Gagal membuat emoji mix: ' + err.message);
                }
            }

            // Unduh gambar
            function downloadImage() {
                if (!currentImageData) return;
                
                const a = document.createElement('a');
                a.href = currentImageData;
                a.download = `emoji-mix-${selectedEmoji1Value}-${selectedEmoji2Value}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                playSound(successSound);
                showSuccess('Gambar berhasil diunduh!');
            }

            // Salin gambar ke clipboard
            async function copyImageToClipboard() {
                if (!currentImageData) return;
                
                try {
                    // Convert data URL to blob
                    const response = await fetch(currentImageData);
                    const blob = await response.blob();
                    
                    // Copy to clipboard
                    await navigator.clipboard.write([
                        new ClipboardItem({
                            [blob.type]: blob
                        })
                    ]);
                    
                    playSound(successSound);
                    showSuccess('Gambar berhasil disalin ke clipboard!');
                } catch (err) {
                    playSound(errorSound);
                    showError('Gagal menyalin gambar: ' + err.message);
                }
            }

            // Browse hasil mix untuk emoji tertentu
            function browseMixResults(emoji, gridNumber) {
                // Untuk demo, kita akan mencari kombinasi yang populer dengan emoji ini
                playSound(clickSound);
                showSuccess(`Mencari hasil mix untuk ${emoji}...`);
                
                // Dalam implementasi nyata, ini akan membuka halaman atau panel dengan hasil mix
            }

            // Pengaturan tema
            function setupThemeToggle() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                    themeToggle.checked = true;
                }
                
                themeToggle.addEventListener('change', () => {
                    if (themeToggle.checked) {
                        document.body.classList.add('dark-theme');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-theme');
                        localStorage.setItem('theme', 'light');
                    }
                });
            }

            // Pengaturan warna kustom
            function setupColorPickers() {
                // Load saved colors
                const savedPrimaryColor = localStorage.getItem('primaryColor');
                if (savedPrimaryColor) {
                    primaryColorPicker.value = savedPrimaryColor;
                    primaryColorPreview.style.backgroundColor = savedPrimaryColor;
                    document.documentElement.style.setProperty('--primary', savedPrimaryColor);
                }
                
                const savedSecondaryColor = localStorage.getItem('secondaryColor');
                if (savedSecondaryColor) {
                    secondaryColorPicker.value = savedSecondaryColor;
                    secondaryColorPreview.style.backgroundColor = savedSecondaryColor;
                    document.documentElement.style.setProperty('--secondary', savedSecondaryColor);
                }
                
                const savedBackgroundColor = localStorage.getItem('backgroundColor');
                if (savedBackgroundColor) {
                    backgroundColorPicker.value = savedBackgroundColor;
                    backgroundColorPreview.style.backgroundColor = savedBackgroundColor;
                    document.documentElement.style.setProperty('--background', savedBackgroundColor);
                }
                
                // Add event listeners
                primaryColorPicker.addEventListener('input', (e) => {
                    const color = e.target.value;
                    primaryColorPreview.style.backgroundColor = color;
                    document.documentElement.style.setProperty('--primary', color);
                    localStorage.setItem('primaryColor', color);
                });
                
                secondaryColorPicker.addEventListener('input', (e) => {
                    const color = e.target.value;
                    secondaryColorPreview.style.backgroundColor = color;
                    document.documentElement.style.setProperty('--secondary', color);
                    localStorage.setItem('secondaryColor', color);
                });
                
                backgroundColorPicker.addEventListener('input', (e) => {
                    const color = e.target.value;
                    backgroundColorPreview.style.backgroundColor = color;
                    document.documentElement.style.setProperty('--background', color);
                    localStorage.setItem('backgroundColor', color);
                });
            }

            // Pengaturan font
            function setupFontSelect() {
                const savedFont = localStorage.getItem('font');
                if (savedFont) {
                    fontSelect.value = savedFont;
                    document.body.style.fontFamily = savedFont;
                }
                
                fontSelect.addEventListener('change', () => {
                    document.body.style.fontFamily = fontSelect.value;
                    localStorage.setItem('font', fontSelect.value);
                });
            }

            // Toggle pengaturan
            function setupSettingsPanel() {
                settingsBtn.addEventListener('click', () => {
                    settingsPanel.classList.toggle('active');
                    playSound(clickSound);
                });
                
                closeSettings.addEventListener('click', () => {
                    settingsPanel.classList.remove('active');
                    playSound(clickSound);
                });
                
                // Tutup panel settings ketika klik di luar
                document.addEventListener('click', (e) => {
                    if (!settingsPanel.contains(e.target) && e.target !== settingsBtn) {
                        settingsPanel.classList.remove('active');
                    }
                });
            }

            // Play sound effect
            function playSound(soundElement) {
                if (soundToggle.checked) {
                    soundElement.currentTime = 0;
                    soundElement.play().catch(e => console.log("Audio play failed:", e));
                }
            }

            // Fungsi bantuan UI
            function showLoading() {
                loading.style.display = 'block';
                resultCanvas.style.display = 'none';
            }

            function hideLoading() {
                loading.style.display = 'none';
            }

            function showError(message) {
                error.textContent = message;
                error.style.display = 'block';
                success.style.display = 'none';
            }

            function hideError() {
                error.style.display = 'none';
            }

            function showSuccess(message) {
                success.textContent = message;
                success.style.display = 'block';
                error.style.display = 'none';
            }

            function hideSuccess() {
                success.style.display = 'none';
            }

            // Setup event listeners
            function setupEventListeners() {
                // Shuffle buttons
                shuffleEmoji1.addEventListener('click', () => shuffleEmoji(1));
                shuffleEmoji2.addEventListener('click', () => shuffleEmoji(2));
                
                // Clear buttons
                clearEmoji1.addEventListener('click', () => clearEmoji(1));
                clearEmoji2.addEventListener('click', () => clearEmoji(2));
                
                // Browse buttons
                browseEmoji1.addEventListener('click', () => browseMixResults(selectedEmoji1Value, 1));
                browseEmoji2.addEventListener('click', () => browseMixResults(selectedEmoji2Value, 2));
                
                // Search inputs
                setupSearch(searchEmoji1, 1);
                setupSearch(searchEmoji2, 2);
                
                // Generate button
                generateBtn.addEventListener('click', generateEmojiMix);
                
                // Download and copy buttons
                downloadBtn.addEventListener('click', downloadImage);
                copyBtn.addEventListener('click', copyImageToClipboard);
                
                // Settings toggles
                setupThemeToggle();
                setupColorPickers();
                setupFontSelect();
                setupSettingsPanel();
                
                // Load saved sound preference
                const savedSound = localStorage.getItem('sound');
                if (savedSound !== null) {
                    soundToggle.checked = savedSound === 'true';
                }
                
                soundToggle.addEventListener('change', () => {
                    localStorage.setItem('sound', soundToggle.checked);
                });
                
                // Load saved vibration preference
                const savedVibration = localStorage.getItem('vibration');
                if (savedVibration !== null) {
                    vibrationToggle.checked = savedVibration === 'true';
                }
                
                vibrationToggle.addEventListener('change', () => {
                    localStorage.setItem('vibration', vibrationToggle.checked);
                });
                
                // Load saved animation preference
                const savedAnimation = localStorage.getItem('animation');
                if (savedAnimation !== null) {
                    animationToggle.checked = savedAnimation === 'true';
                }
                
                animationToggle.addEventListener('change', () => {
                    localStorage.setItem('animation', animationToggle.checked);
                });
            }

            // Inisialisasi aplikasi
            setRandomLogo();
            await loadEmojiData();
            setupEventListeners();
        });
    </script>
</body>
</html>
